"use strict";function ATON(){return this.options={},this}ATON.prototype.defaultOptions={recordTerminator:"\n",metaMarker:"@@",objectBegin:["BEGIN","START"],objectEnd:["END","STOP"],commentMarker:"^@{5,}|^@{1,4}[^@]|^@{,4}$",keyMarker:"@",keyTerminator:"s*:s*",keyTerminatorOut:":	",forceKeyCase:"",forceType:void 0},ATON.prototype.getOption=function(e){return this.options===void 0||"undefined"===this.options[e]?this.defaultOptions[e]:"object"==typeof this.options&&this.options[e]===void 0?this.defaultOptions[e]:this.options[e]},ATON.prototype.setOption=function(e,t){return this.options===void 0&&(this.options={}),this.options[e]=t,this},ATON.prototype.setLCKeys=function(){return this.setOption("forceKeyCase","lc"),this},ATON.prototype.setUCKeys=function(){return this.setOption("forceKeyCase","uc"),this},ATON.prototype.setOCKeys=function(){return this.setOption("forceKeyCase",""),this},ATON.prototype.getOptionString=function(e){var t=this.getOption(e);return"string"==typeof t?t:t instanceof Array?t.length?""+t[0]:"":"number"==typeof t?t+"":""},ATON.prototype.resetOptions=function(){this.options={}},ATON.prototype.parse=function(e){return this.parseRecordArray(e.split(/\n/))},ATON.prototype._initializeParsingStateVariables=function(){return{action:void 0,label:void 0,labelbegin:void 0,labelend:void 0,curobj:void 0,curobjname:void 0,curkey:void 0,newkey:void 0,newvalue:void 0,linenum:void 0,node:[],typer:{},output:{},keycase:this.getOptionString("forceKeyCase")}},ATON.prototype.parseRecordArray=function(e){if(!(e instanceof Array)||0===e.length||"string"!=typeof e[0])return{};var t=this._initializeParsingStateVariables();t.curobj=t.output;for(var r=0;e.length>r;r++){t.linenum=r+1;try{this._parseRecord(e[r],t)}catch(o){console.log(o),process.exit(1)}}var n=t;return this._cleanParameter(n),n.output},ATON.prototype._parseRecord=function(e,t){var r;if(!(e.match(/^@{5,}|^@+\s|^@{1,4}$/)||void 0===t.curkey&&e.match(/^[^@]|^$/)))if(r=e.match(/^@@[^@ ]/))if(this._cleanParameter(t),t.curkey=void 0,r=e.match(/^@@(BEGIN|START)\s*:\s*(.*)\s*$/i))t.label=r[2],t.curobj[t.label]===void 0?(t.curobj[t.label]={},t.node.push({label:t.label,startline:t.linenum}),t.curobj=t.curobj[t.label]):t.curobj[t.label]instanceof Array?(t.curobj[t.label].push({}),t.node.push({}),t.node[t.node.length-1].index=t.curobj[t.label].length-1,t.node[t.node.length-1].label=t.label,t.node[t.node.length-1].startline=t.linenum,t.curobj=t.curobj[t.label][t.curobj[t.label].length-1]):(t.curobj[t.label],t.curobj[t.label]=[t.curobj[t.label],{}],t.node.push({}),t.node[t.node.length-1].index=t.curobj[t.label].length-1,t.node[t.node.length-1].label=t.label,t.node[t.node.length-1].startline=t.linenum,t.curobj=t.curobj[t.label][t.curobj[t.label].length-1]);else if(r=e.match(/^@@(END|STOP)\s*:?\s*(.*)\s*$/i)){if(t.curkey!==void 0&&(t.curobj[t.curkey]=t.curobj[t.curkey].replace(/^\s+|\s+$/g,""),t.curkey=void 0),t.action=r[1],t.labelend=r[2],t.labelbegin=t.node[t.node.length-1].label,t.node[t.node.length-1].startline===void 0)throw Error("No start for "+t.action+" tag on line "+t.node[t.node.length-1].startline+": "+e);if(t.labelend!==void 0&&t.labelbegin!==t.labelend&&""!==t.labelend)throw Error("Labels do not match on lines "+t.node[t.node.length-1].startline+" and "+t.linenum+': "'+t.labelbegin+'" compared to "'+t.labelend+'".');if(!t.node)throw Error("Error on line "+t.linenum+": already at object root.");t.node.pop(),t.curobj=t.node.reduce(function(e,t){return e[t.label]instanceof Array?e[t.label][t.index]:e[t.label]},t.output)}else(r=e.match(/^@@TYPE\s*:\s*([^:]+)\s*:\s*(.*)\s*$/i))&&(t.typer[r[1]]=r[2]);else(r=e.match(/^@([^\s:@][^:]*)\s*:\s*(.*)\s*$/))?(t.newkey=r[1],t.newvalue=r[2],this._cleanParameter(t),t.curkey="uc"===t.keycase?t.newkey.toUpperCase():"lc"===t.keycase?t.newkey.toLowerCase():t.newkey,t.curobj[t.curkey]===void 0?t.curobj[t.curkey]=t.newvalue:t.curobj[t.curkey]instanceof Array?t.curobj[t.curkey].push(t.newvalue):t.curobj[t.curkey]=[t.curobj[t.curkey],t.newvalue]):t.curkey!==void 0&&(e=e.replace(/^\\/,""),t.curobj[t.curkey]instanceof Array?t.curobj[t.curkey][t.curobj[t.curkey].length-1]+="\n"+e:t.curobj[t.curkey]+="\n"+e)},ATON.prototype._cleanParameter=function(e){if(e.curkey!==void 0&&e.curobj&&e.curobj[e.curkey]){var t;if(e.curobj[e.curkey]instanceof Array?t=e.curobj[e.curkey][e.curobj[e.curkey].length-1]:"string"==typeof e.curobj[e.curkey]&&(t=e.curobj[e.curkey]),t=t.replace(/^\s+|\s+$/g,""),e.typer&&e.typer[e.newkey]!==void 0){var r=e.typer[e.newkey];r.match(/number/i)?t=Number(t):r.match(/integer/i)?t=parseInt(t):r.match(/json/i)&&(t=JSON.parse(t))}e.curobj[e.curkey]instanceof Array?e.curobj[e.curkey][e.curobj[e.curkey].length-1]=t:"string"==typeof e.curobj[e.curkey]&&(e.curobj[e.curkey]=t)}},ATON.prototype.stringify=function(e,t){var r="";if("object"!=typeof e)return r;if(e instanceof Array)for(var o=0;e.length>o;o++)r+=this.stringify(e[o],t);else t&&(r+=this.getOptionString("metaMarker"),r+=this.getOptionString("objectBegin"),r+=this.getOptionString("keyTerminatorOut"),r+=t,r+=this.getOptionString("recordTerminator")),Object.keys(e).forEach(function(t){var o=e[t];if(!(o instanceof Function))if(o instanceof Array&&o.length)for(var n=0;o.length>n;n++)r+="object"==typeof o[n]?this.stringify(o[n],t):this._printSingleParameter(t,o[n]);else r+="object"==typeof o?this.stringify(o,t):this._printSingleParameter(t,o)},this),t&&(r+=this.getOptionString("metaMarker"),r+=this.getOptionString("objectEnd"),r+=this.getOptionString("keyTerminatorOut"),r+=t,r+=this.getOptionString("recordTerminator"));return r},ATON.prototype._printSingleParameter=function(e,t){var r="";return r+=this.getOptionString("keyMarker"),r+=e,r+=this.getOptionString("keyTerminatorOut"),r+=t,r+=this.getOptionString("recordTerminator")},"undefined"!=typeof module&&module.hasOwnProperty("exports")&&(module.exports=ATON);