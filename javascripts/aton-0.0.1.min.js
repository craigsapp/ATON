"use strict";function ATON(){return this.options={},this}ATON.prototype.defaultOptions={recordTerminator:"\n",metaMarker:"@@",objectBegin:["BEGIN","START"],objectEnd:["END","STOP"],commentMarker:"^@{5,}|^@{1,4}[^@]|^@{,4}$",keyMarker:"@",keyTerminator:"s*:s*",keyTerminatorOut:":	",forceKeyCase:"",forceType:void 0},ATON.prototype.getOption=function(e){return this.options===void 0||"undefined"===this.options[e]?this.defaultOptions[e]:"object"==typeof this.options&&this.options[e]===void 0?this.defaultOptions[e]:this.options[e]},ATON.prototype.getOptionString=function(e){var r=this.getOption(e);return"string"==typeof r?r:r instanceof Array?r.length?""+r[0]:"":"number"==typeof r?r+"":""},ATON.prototype.resetOptions=function(){this.options={}},ATON.prototype.parse=function(e){return this.parseRecordArray(e.split(/\n/))},ATON.prototype._initializeParsingStateVariables=function(){return{action:void 0,label:void 0,labelbegin:void 0,labelend:void 0,curobj:void 0,curobjname:void 0,curkey:void 0,newkey:void 0,newvalue:void 0,linenum:void 0,node:[],typer:{},output:{}}},ATON.prototype.parseRecordArray=function(e){if(!(e instanceof Array)||0===e.length||"string"!=typeof e[0])return{};var r=this._initializeParsingStateVariables();r.curobj=r.output;for(var t=0;e.length>t;t++){r.linenum=t+1;try{this._parseRecord(e[t],r)}catch(o){console.log(o),process.exit(1)}}var n=r;return this._cleanParameter(n),n.output},ATON.prototype._parseRecord=function(e,r){var t;if(!(e.match(/^@{5,}|^@+\s|^@{1,4}$/)||void 0===r.curkey&&e.match(/^[^@]|^$/)))if(t=e.match(/^@@[^@ ]/))if(this._cleanParameter(r),r.curkey=void 0,t=e.match(/^@@(BEGIN|START)\s*:\s*(.*)\s*$/i))r.label=t[2],r.curobj[r.label]===void 0?(r.curobj[r.label]={},r.node.push({label:r.label,startline:r.linenum}),r.curobj=r.curobj[r.label]):r.curobj[r.label]instanceof Array?(r.curobj[r.label].push({}),r.node[r.node.length-1].index=r.curobj[r.label].length-1,r.curobj=r.curobj[r.label][r.curobj[r.label].length-1]):(r.curobj[r.label],r.curobj[r.label]=[r.curobj[r.label],{}],r.node[r.node.length-1].index=r.curobj[r.label].length-1,r.curobj=r.curobj[r.label][r.curobj[r.label].length-1]);else if(t=e.match(/^@@(END|STOP)\s*:?\s*(.*)\s*$/i)){if(r.curkey!==void 0&&(r.curobj[r.curkey]=r.curobj[r.curkey].replace(/^\s+|\s+$/g,""),r.curkey=void 0),r.action=t[1],r.labelend=t[2],r.labelbegin=r.node[r.node.length-1].label,r.node[r.node.length-1].startline===void 0)throw Error("No start for "+r.action+" tag on line "+r.node[r.node.length-1].startline+": "+e);if(r.labelend!==void 0&&r.labelbegin!==r.labelend&&""!==r.labelend)throw Error("Labels do not match on lines "+r.node[r.node.length-1].startline+" and "+r.linenum+': "'+r.labelbegin+'" compared to "'+r.labelend+'".');if(!r.node)throw Error("Error on line "+r.linenum+": already at object root.");r.node.pop(),r.curobj=r.node.reduce(function(e,r){return e[r]instanceof Array?e[r.label][r.index]:e[r]},r.output)}else(t=e.match(/^@@TYPE\s*:\s*([^:]+)\s*:\s*(.*)\s*$/i))&&(r.typer[t[1]]=t[2]);else(t=e.match(/^@([^\s:@][^:]*)\s*:\s*(.*)\s*$/))?(r.newkey=t[1],r.newvalue=t[2],this._cleanParameter(r),r.curkey=r.newkey,r.curobj[r.curkey]===void 0?r.curobj[r.curkey]=r.newvalue:r.curobj[r.curkey]instanceof Array?r.curobj[r.curkey].push(r.newvalue):r.curobj[r.curkey]=[r.curobj[r.curkey],r.newvalue]):r.curkey!==void 0&&(e=e.replace(/^\\/,""),r.curobj[r.curkey]instanceof Array?r.curobj[r.curkey][r.curobj[r.curkey].length-1]+="\n"+e:r.curobj[r.curkey]+="\n"+e)},ATON.prototype._cleanParameter=function(e){if(e.curkey!==void 0&&e.curobj&&e.curobj[e.curkey]){var r;if(e.curobj[e.curkey]instanceof Array?r=e.curobj[e.curkey][e.curobj[e.curkey].length-1]:"string"==typeof e.curobj[e.curkey]&&(r=e.curobj[e.curkey]),r=r.replace(/^\s+|\s+$/g,""),e.typer&&e.typer[e.curkey]!==void 0){var t=e.typer[e.curkey];t.match(/number/i)?r=Number(r):t.match(/integer/i)?r=parseInt(r):t.match(/json/i)&&(r=JSON.parse(r))}e.curobj[e.curkey]instanceof Array?e.curobj[e.curkey][e.curobj[e.curkey].length-1]=r:"string"==typeof e.curobj[e.curkey]&&(e.curobj[e.curkey]=r)}},ATON.prototype.stringify=function(e,r){var t="";if("object"!=typeof e)return t;if(e instanceof Array)for(var o=0;e.length>o;o++)t+=this.stringify(e[o],r);else r&&(t+=this.getOptionString("metaMarker"),t+=this.getOptionString("objectBegin"),t+=this.getOptionString("keyTerminatorOut"),t+=r,t+=this.getOptionString("recordTerminator")),Object.keys(e).forEach(function(r){var o=e[r];if(!(o instanceof Function))if(o instanceof Array&&o.length)for(var n=0;o.length>n;n++)t+="object"==typeof o[n]?this.stringify(o[n],r):this._printSingleParameter(r,o[n]);else t+="object"==typeof o?this.stringify(o,r):this._printSingleParameter(r,o)},this),r&&(t+=this.getOptionString("metaMarker"),t+=this.getOptionString("objectEnd"),t+=this.getOptionString("keyTerminatorOut"),t+=r,t+=this.getOptionString("recordTerminator"));return t},ATON.prototype._printSingleParameter=function(e,r){var t="";return t+=this.getOptionString("keyMarker"),t+=e,t+=this.getOptionString("keyTerminatorOut"),t+=r,t+=this.getOptionString("recordTerminator")},"undefined"!=typeof module&&module.hasOwnProperty("exports")&&(module.exports=ATON);