"use strict";function ATON(){return this.options={},this}ATON.prototype.defaultOptions={recordTerminator:"\n",metaMarker:"@@",objectBegin:["BEGIN","START"],objectEnd:["END","STOP"],commentMarker:"^@{5,}|^@{1,4}[^@]|^@{,4}$",keyMarker:"@",keyTerminator:"s*:s*",keyTerminatorOut:":	",forceKeyCase:"",forceType:void 0},ATON.prototype.getOption=function(e){return"undefined"==typeof this.options||"undefined"===this.options[e]?this.defaultOptions[e]:"object"==typeof this.options&&"undefined"==typeof this.options[e]?this.defaultOptions[e]:this.options[e]},ATON.prototype.getOptionString=function(e){var t=this.getOption(e);return"string"==typeof t?t:t instanceof Array?t.length?t[0].toString():"":"number"==typeof t?String(t):""},ATON.prototype.resetOptions=function(){this.options={}},ATON.prototype.parse=function(e){return this.parseRecordArray(e.split(/\n/))},ATON.prototype._initializeParsingStateVariables=function(){return{action:void 0,label:void 0,labelbegin:void 0,labelend:void 0,curobj:void 0,curobjname:void 0,curkey:void 0,newkey:void 0,newvalue:void 0,linenum:void 0,node:[],typer:{},output:{}}},ATON.prototype.parseRecordArray=function(e){if(!(e instanceof Array)||0===e.length||"string"!=typeof e[0])return{};var t=this._initializeParsingStateVariables();t.curobj=t.output;for(var r=0;r<e.length;r++){t.linenum=r+1;try{this._parseRecord(e[r],t)}catch(n){console.log(n),process.exit(1)}}var o=t;return this._cleanParameter(o),o.output},ATON.prototype._parseRecord=function(e,t){var r;if(!(e.match(/^@{5,}|^@+\s|^@{1,4}$/)||"undefined"==typeof t.curkey&&e.match(/^[^@]|^$/)))if(r=e.match(/^@@[^@ ]/))if(this._cleanParameter(t),t.curkey=void 0,r=e.match(/^@@(BEGIN|START)\s*:\s*(.*)\s*$/i))if(t.label=r[2],"undefined"==typeof t.curobj[t.label])t.curobj[t.label]={},t.node.push({label:t.label,startline:t.linenum}),t.curobj=t.curobj[t.label];else if(t.curobj[t.label]instanceof Array)t.curobj[t.label].push({}),t.node[t.node.length-1].index=t.curobj[t.label].length-1,t.curobj=t.curobj[t.label][t.curobj[t.label].length-1];else{{t.curobj[t.label]}t.curobj[t.label]=[t.curobj[t.label],{}],t.node[t.node.length-1].index=t.curobj[t.label].length-1,t.curobj=t.curobj[t.label][t.curobj[t.label].length-1]}else if(r=e.match(/^@@(END|STOP)\s*:?\s*(.*)\s*$/i)){if("undefined"!=typeof t.curkey&&(t.curobj[t.curkey]=t.curobj[t.curkey].replace(/^\s+|\s+$/g,""),t.curkey=void 0),t.action=r[1],t.labelend=r[2],t.labelbegin=t.node[t.node.length-1].label,"undefined"==typeof t.node[t.node.length-1].startline)throw new Error("No start for "+t.action+" tag on line "+t.node[t.node.length-1].startline+": "+e);if("undefined"!=typeof t.labelend&&t.labelbegin!==t.labelend&&""!==t.labelend)throw new Error("Labels do not match on lines "+t.node[t.node.length-1].startline+" and "+t.linenum+': "'+t.labelbegin+'" compared to "'+t.labelend+'".');if(!t.node)throw new Error("Error on line "+t.linenum+": already at object root.");t.node.pop(),t.curobj=t.node.reduce(function(e,t){return e[t]instanceof Array?e[t.label][t.index]:e[t]},t.output)}else(r=e.match(/^@@TYPE\s*:\s*([^:]+)\s*:\s*(.*)\s*$/i))&&(t.typer[r[1]]=r[2]);else(r=e.match(/^@([^\s:@][^:]*)\s*:\s*(.*)\s*$/))?(t.newkey=r[1],t.newvalue=r[2],this._cleanParameter(t),t.curkey=t.newkey,"undefined"==typeof t.curobj[t.curkey]?t.curobj[t.curkey]=t.newvalue:t.curobj[t.curkey]instanceof Array?t.curobj[t.curkey].push(t.newvalue):t.curobj[t.curkey]=[t.curobj[t.curkey],t.newvalue]):(e=e.replace(/^\\/,""),t.curobj[t.curkey]instanceof Array?t.curobj[t.curkey][t.curobj[t.curkey].length-1]+="\n"+e:t.curobj[t.curkey]+="\n"+e)},ATON.prototype._cleanParameter=function(e){if("undefined"!=typeof e.curkey&&e.curobj&&e.curobj[e.curkey]){var t;if(e.curobj[e.curkey]instanceof Array?t=e.curobj[e.curkey][e.curobj[e.curkey].length-1]:"string"==typeof e.curobj[e.curkey]&&(t=e.curobj[e.curkey]),t=t.replace(/^\s+|\s+$/g,""),e.typer&&"undefined"!=typeof e.typer[e.curkey]){var r=e.typer[e.curkey];r.match(/number/i)?t=Number(t):r.match(/integer/i)&&(t=parseInt(t))}e.curobj[e.curkey]instanceof Array?e.curobj[e.curkey][e.curobj[e.curkey].length-1]=t:"string"==typeof e.curobj[e.curkey]&&(e.curobj[e.curkey]=t)}},ATON.prototype.stringify=function(e,t){var r="";if("object"!=typeof e)return r;if(e instanceof Array)for(var n=0;n<e.length;n++)r+=this.stringify(e[n],t);else t&&(r+=this.getOptionString("metaMarker"),r+=this.getOptionString("objectBegin"),r+=this.getOptionString("keyTerminatorOut"),r+=t,r+=this.getOptionString("recordTerminator")),Object.keys(e).forEach(function(t){var n=e[t];if(!(n instanceof Function))if(n instanceof Array&&n.length)for(var o=0;o<n.length;o++)r+="object"==typeof n[o]?this.stringify(n[o],t):this._printSingleParameter(t,n[o]);else r+="object"==typeof n?this.stringify(n,t):this._printSingleParameter(t,n)},this),t&&(r+=this.getOptionString("metaMarker"),r+=this.getOptionString("objectEnd"),r+=this.getOptionString("keyTerminatorOut"),r+=t,r+=this.getOptionString("recordTerminator"));return r},ATON.prototype._printSingleParameter=function(e,t){var r="";return r+=this.getOptionString("keyMarker"),r+=e,r+=this.getOptionString("keyTerminatorOut"),r+=t,r+=this.getOptionString("recordTerminator")},"undefined"!=typeof module&&module.hasOwnProperty("exports")&&(module.exports=ATON);
